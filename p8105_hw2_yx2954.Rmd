---
title: "p8105_hw2_yx2954"
author: "Yiran Xu"
date: "2024-09-27"
output: github_document
---

# Question 1

```{r, echo = FALSE, message = FALSE}
library(dplyr)
library(readr)
library(tidyr)
library(readxl)
library(tidyverse)
library(stringr)
```

```{r}
subway_df = read_csv("data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv", na = c("NA", "", ".")) |>
  select(Line, Station_Name = `Station Name`, Station_Latitude = `Station Latitude`, Station_Longitude = `Station Longitude`, Route1:Route11, Entry, Vending, Entrance_Type = `Entrance Type`, ADA) |>
  mutate(Entry = ifelse(Entry == "YES", TRUE, FALSE))|>
  janitor::clean_names()

head(subway_df)
```

## Description

The original dataset contains different types of **variables**, **including character**, **logical variable** and double-precision floating point (**numeric variable**); As for the information, it contains **detailed information about subway stations, including station name, exact locations, the routes they serve, entrance/exit information, ADA compliance, vending availability, staffing information, entrance location, corner location and whether the station allows free crossovers**.
The original dataset has gone through a series of data cleaning process, including **imputing missing data, data pruning, converting the character variable of ADA to logical variable, and normalizing the header into a more cleaning way**. The cleaned data has a dimension of **1,868 Ã— 32**. The data is **tidy**, as now each value in the entry is finely positioned without mixing.

## Answer the following questions using these data:

```{r}
num_station = 
  subway_df |>
  distinct(line, station_name) |>
  nrow()

num_ada =
  subway_df |>
  filter(ada == TRUE) |>
  distinct(line, station_name) |>
  nrow()

prop_vending = subway_df |>
  filter(vending == "NO") |>
  summarise(proportion = mean(entry == TRUE)) |>
  pull(proportion)
```

There are **`r num_station`** stations, **`r num_ada`** of them are ADA compliant, **`r prop_vending`** of station entrances / exits without vending allow entrance

## Reformat data

```{r}
subway_tidy_df = 
  subway_df |>
  mutate(across(route8:route11, as.character)) |>
  pivot_longer(
    cols = starts_with("route"),
    names_to = "route_number",  
    values_to = "route_name",   
    values_drop_na = TRUE      
  )
```

Calculate number of A train station with ADA

```{r}
num_a_ada = 
  subway_tidy_df |>
  filter(route_name == "A") |>
  filter(ada == TRUE) |>
  nrow()
```

Of the stations that serve the A train, **`r num_a_ada`** are ADA compliant


# Question 2

```{r}
mr_df = read_excel("data/202309 Trash Wheel Collection Data.xlsx", sheet = "Mr. Trash Wheel", range = "A2:N587", na = c("NA", "", ",")) |>
  filter(!is.na(Dumpster)) |>
  janitor::clean_names() |>
  mutate(sports_balls = as.integer(round(sports_balls, 0)), homes_powered = (
      weight_tons*500/30))

head(mr_df)
```

Import other data frames

```{r}
mr_df = mr_df |>
  mutate(trash_wheel = "Mr. Trash Wheel")

prof_df = read_excel("data/202309 Trash Wheel Collection Data.xlsx", sheet = "Professor Trash Wheel", range = "A2:M109", na = c("NA", "", ",")) |>
  filter(!is.na(Dumpster)) |>
  janitor::clean_names() |>
  mutate(year = as.character(year), trash_wheel = "Professor Trash Wheel", homes_powered = (
      weight_tons*500/30))

gwyn_df = read_excel("data/202309 Trash Wheel Collection Data.xlsx", sheet = "Gwynnda Trash Wheel", range = "A2:L159", skip = 1, na = c("NA", "", ",")) |>
  filter(!is.na(Dumpster)) |>
  janitor::clean_names() |>
  mutate(year = as.character(year), trash_wheel = "Gwynnda Trash Wheel",homes_powered = (
      weight_tons*500/30))
```

Combine all data frame

```{r}
combined_df = bind_rows(mr_df, prof_df, gwyn_df) |>
  janitor::clean_names() |>
  arrange(date, dumpster) 
```

## data descrption

In total, the combined dataset contains **`r nrow(combined_df)`** observations. Key variables include the exact date when collecting data, the weight, volume of different type of trash collected. The data collected by different dumpster is denoted by the variable trash_wheel. It should be noted that the three types of dumpster has differerent number of variables. For Mr. Trash Wheel, it has **`r ncol(mr_df)`** variables, while Professor Trash Wheel and Gwynnda Trash Wheel has **`r ncol(prof_df)`** and **`r ncol(gwyn_df)`** variables, respectively.
The total weight of trash collected by Professor Trash Wheel was **`r sum(pull(mr_df, weight_tons))`** tons. The total number of cigarette butts collected by Gwynnda in June of 2022 **`r sum(gwyn_df |> filter(year == 2022, month == "June") |> pull(cigarette_butts))`**


# Qustion 3

Import data

```{r}

bakers_df = read_csv(file = "data/gbb_datasets/bakers.csv", na = c("NA", "", ".")) |>
  janitor::clean_names() |>
  mutate(baker = baker_name) |>
  select(-baker_name)    

bakes_df = read_csv(file = "data/gbb_datasets/bakes.csv", , na = c("NA", "", ".")) |>
  janitor::clean_names()

results_df = read_csv(file = "data/gbb_datasets/results.csv", skip = 2, na = c("NA", "", ".")) |>
  janitor::clean_names()

```

Check completeness and correctness:

It can be noted that the names provided in bakers_df are full names, while names in bakes_df and results_df are only the first name. In order to match the names, we should first convert the full name to first name in the bakers_df, and then match the exact baker by name, series, and episode.

```{r}
bakers_df = bakers_df |>
  mutate(baker = str_split(baker, " ", simplify = TRUE)[,1])
```

check correctness

```{r}
anti_join(bakes_df, bakers_df, by = "baker")
```

We found that their is a typo error for the name "Jo", and we should change it

```{r}
bakes_df = bakes_df |>
  mutate(baker = gsub('"', '', baker))

anti_join(bakes_df, bakers_df, by = "baker")
```

Now we have done the check of these 2 data frames! We need to further check other variables.

```{r}
anti_join(bakes_df, bakers_df, results_df, by = "baker")
anti_join(bakes_df, bakers_df, results_df, by = c("baker", "series"))
```

No result returned, indicating we have done the checking of correctness and completeness! Now merge them together.

```{r}
merged_df = bakes_df |>
  left_join(bakers_df, by = c("baker", "series")) |>
  left_join(results_df, by = c("baker", "series", "episode")) |>
  select(baker, baker_age, baker_occupation, hometown, everything())
```

